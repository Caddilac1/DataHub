<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>DataHub - Your Data Connection</title>
</head>
<body>
    <div class="container">
        <div class="navbar">
            <div class="navbar-brand">
                DataHub
            </div>
            
            <div class="navbar-menu">
                <a class="navbar-item active" data-nav="dashboard">Dashboard</a>
                <a class="navbar-item" data-nav="orders">Recent Orders</a>
                <a class="navbar-item" data-nav="history">Order History</a>
                <a class="navbar-item" data-nav="profile">Profile</a>
            </div>
            
            <div class="profile-avatar" id="profileAvatar">{{ request.user.full_name|slice:":1"|upper }}</div>
            <button class="logout-btn" onclick="logoutUser()">Logout</button>
        </div>

        <div id="particles"></div>

        <div class="header fade-in-up">
            <h1>DataHub</h1>
            <div class="greeting" id="greeting">Welcome, {{ request.user.full_name }}! üëã</div>
            <p>Your Reliable Data Connection Partner in Ghana</p>
        </div>

        <div class="warning-notice fade-in-up">
            <h3>‚ö†Ô∏è STRICT POLICY: NO SOCIAL MEDIA ADVERTISING</h3>
            <p><strong>We do NOT allow social media advertisements of our services. If we find this page or our services advertised on your social media accounts, your account will be PERMANENTLY DELETED from our system without warning.</strong></p>
            <p>This policy is strictly enforced to maintain service quality and prevent abuse. No exceptions will be made.</p>
            <h3 style="margin-top: 15px;">Important Notice</h3>
            <p>Turbonet and Broadband Sim Cards are <strong>not eligible for this offer</strong>.</p>
            <ul>
                <li>Please do not place orders for the same number at the same time interval. One will be rejected and <strong>no refund will be provided</strong>.</li>
                <li>Data bundle delivery is not instant. Some numbers may receive data faster while others take some time.</li>
                <li>No refunds will be issued for wrong transactions or incorrect phone numbers.</li>
                <li>Please verify your phone number carefully before making a purchase.</li>
            </ul>
        </div>

        <div class="service-notice fade-in-up">
            <h3>Important Service Notice</h3>
            <p><strong>Please Note Before Proceeding:</strong></p>
            <ul>
                <li>This is <strong>not an instant service</strong>. Data delivery times vary between customers.</li>
                <li>We are working diligently to process all orders, but there may be delays.</li>
                <li>If you need immediate data for urgent matters, please dial <strong>*138#</strong> on your MTN line instead.</li>
                <li>Once ordered, please be patient as we process your request.</li>
                <li>For instant bundles, this service is not suitable.</li>
            </ul>
            <p style="margin-top: 10px;"><em>We value your business and are committed to delivering quality service. Thank you for your understanding and patience.</em></p>
        </div>

        <div class="content-section active" id="dashboard">
            <div class="dashboard">
                {% for telco_name, plans in data_plans.items %}
                    <div class="network-card">
                        <div class="stock-status stock-in">IN STOCK</div>
                        <div class="network-header">
                            <div class="network-logo">{{ telco_name|slice:":3"|upper }}</div>
                            <div class="network-name">{{ telco_name }}</div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">N/A</div>
                                <div class="stat-label">Orders Today</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">N/A</div>
                                <div class="stat-label">Success Rate</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">N/A</div>
                                <div class="stat-label">Avg Processing</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">24/7</div>
                                <div class="stat-label">Available</div>
                            </div>
                        </div>
                        <button class="buy-btn" onclick="openModal('{{ telco_name }}')">Buy Data Bundle</button>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="content-section" id="orders">
            <div class="orders-section">
                <h2>üìã Recent Orders (Last 24 Hours)</h2>
                <div style="overflow-x: auto;">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Network</th>
                                <th>Phone Number</th>
                                <th>Data Size</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date & Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td>{{ order.id }}</td>
                                <td>{{ order.telco.name }}</td>
                                <td>{{ order.phone_number|slice:"0:4" }}******{{ order.phone_number|slice:"8:10" }}</td>
                                <td>{{ order.bundle.size_mb|divisibleby:1000|yesno:"GB,MB" }}</td>
                                <td>GH‚Çµ {{ order.payment.amount }}</td>
                                <td><span class="status-badge status-{{ order.status }}">{{ order.get_status_display }}</span></td>
                                <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7">You have no recent orders.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="content-section" id="history">
            <div class="orders-section">
                <h2>üìö Complete Order History</h2>
                <div style="overflow-x: auto;">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Network</th>
                                <th>Phone Number</th>
                                <th>Data Size</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date & Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in order_history %}
                            <tr>
                                <td>{{ order.id }}</td>
                                <td>{{ order.telco.name }}</td>
                                <td>{{ order.phone_number|slice:"0:4" }}******{{ order.phone_number|slice:"8:10" }}</td>
                                <td>{{ order.bundle.size_mb|divisibleby:1000|yesno:"GB,MB" }}</td>
                                <td>GH‚Çµ {{ order.payment.amount }}</td>
                                <td><span class="status-badge status-{{ order.status }}">{{ order.get_status_display }}</span></td>
                                <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7">Your order history is empty.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="content-section" id="profile">
            <div class="orders-section">
                <h2>üë§ Profile Information</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; position: relative; z-index: 1;">
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 25px; border-radius: 20px; border: 2px solid rgba(76, 175, 80, 0.2);">
                        <h3 style="color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üìù Account Details
                        </h3>
                        <p><strong>Full Name:</strong> <span id="userFullName">{{ request.user.full_name }}</span></p>
                        <p><strong>Username:</strong> <span id="username">{{ request.user.email }}</span></p>
                        <p><strong>Email:</strong> <span id="userEmail">{{ request.user.email }}</span></p>
                        <p><strong>Date Joined:</strong> <span id="dateJoined">{{ request.user.date_joined|date:"M j, Y" }}</span></p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #e8f5e8, #d4edda); padding: 25px; border-radius: 20px; border: 2px solid rgba(76, 175, 80, 0.3);">
                        <h3 style="color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üìä Account Statistics
                        </h3>
                        <p><strong>Total Orders:</strong> <span style="color: #4CAF50; font-weight: bold;" id="totalOrders">{{ total_orders }}</span></p>
                        <p><strong>Successful Orders:</strong> <span style="color: #4CAF50; font-weight: bold;" id="successfulOrders">{{ successful_orders }}</span></p>
                        <p><strong>Success Rate:</strong> <span style="color: #4CAF50; font-weight: bold;" id="successRate">{{ success_rate }}%</span></p>
                        <p><strong>Total Spent:</strong> <span style="color: #4CAF50; font-weight: bold;" id="totalSpent">GH‚Çµ {{ total_spent }}</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">Purchase Data Bundle</h3>
            
            <div class="modal-notice">
                <strong>‚ö†Ô∏è Important Reminders:</strong><br>
                ‚Ä¢ Double-check your phone number before purchasing<br>
                ‚Ä¢ Data delivery is <strong>not instant</strong> - please be patient<br>
                ‚Ä¢ No refunds for wrong numbers or duplicate orders
            </div>
            
            <div class="data-plans" id="dataPlans">
                {% for telco_name, plans in data_plans.items %}
                    <div class="plans-group" data-telco="{{ telco_name }}">
                        <h3>{{ telco_name }} Bundles</h3>
                        {% for plan in plans %}
                            <div class="plan-item" data-id="{{ plan.id }}" data-price="{{ plan.price }}">
                                <span class="plan-size">{{ plan.size }}</span>
                                <span class="plan-validity">{{ plan.validity }}</span>
                                <span class="plan-price">GH‚Çµ {{ plan.price }}</span>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

            <input type="tel" class="phone-input" id="phoneInput" placeholder="Enter phone number (must start with 0)" maxlength="10">
            <div class="input-error" id="phoneError" style="display: none;"></div>
            
            <div id="selectedPlan" style="display: none; background: linear-gradient(135deg, #e8f5e8, #d4edda); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #4CAF50;">
                <div style="font-weight: bold; margin-bottom: 8px; color: #2c3e50;">Selected Plan:</div>
                <div id="selectedPlanDetails"></div>
            </div>

            <button class="purchase-btn" id="purchaseBtn" onclick="processPurchase()" disabled>
                Complete Purchase
            </button>
        </div>
    </div>

    <script>
        // Data is now rendered directly in the template, no need for JSON variable
        // The purchase modal will require some JS to function, but it won't be using the JSON data.
        // It will need to handle the phone number input and selected plan logic.
        const dataPlans = {}; // Placeholder, as we are no longer using the JSON.
        window.userFullName = "{{ request.user.full_name|escapejs }}";
    </script>
    <script src="{% static 'js/testhome.js' %}"></script>
    {% include 'components/messages.html' %}
</body>
</html>